<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Produce Price Checker</title>
  <style>
    :root{--radius:16px}
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;margin:0;background:#0b1020;color:#eef1f7}
    header{padding:24px 16px;text-align:center;background:linear-gradient(180deg,#151b35,#0b1020)}
    h1{margin:0;font-size:24px}
    main{max-width:820px;margin:16px auto;padding:0 16px 64px}
    .card{background:#121A36;border:1px solid #273055;border-radius:var(--radius);padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.25);margin-bottom:16px}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .row>*{flex:1}
    input,button,select,textarea{background:#0f1530;color:#e9ecf5;border:1px solid #2a355f;border-radius:12px;padding:12px;outline:none}
    input:focus,select:focus,textarea:focus{border-color:#7aa4ff;box-shadow:0 0 0 3px rgba(122,164,255,.15)}
    button{cursor:pointer}
    .muted{opacity:.8;font-size:13px}
    .pill{display:inline-block;padding:4px 8px;border-radius:999px;font-size:12px;border:1px solid #2a355f;background:#0f1530}
    .good{color:#24d07a}
    .warn{color:#ffc658}
    .bad{color:#ff6b6b}
    .grid{display:grid;grid-template-columns:1fr 120px 120px 120px;gap:8px;align-items:center}
    .header{font-weight:600;opacity:.9}
    .item{padding:8px;border-bottom:1px dashed #273055}
    .actions{display:flex;gap:8px;justify-content:flex-end}
    .hidden{display:none}
    .tag{font-size:11px;opacity:.85}
    .table{overflow:auto}
    .footer{position:fixed;bottom:12px;left:0;right:0;display:flex;justify-content:center}
    .toast{background:#121A36;border:1px solid #2a355f;color:#e9ecf5;padding:10px 14px;border-radius:12px}
    @media (max-width:720px){.grid{grid-template-columns:1fr 90px 90px 90px}}
  </style>
</head>
<body>
<header>
  <h1>Produce Price Checker</h1>
  <p class="muted">Type a fruit/veg to see a reasonable buy range. Edit to match your local market.</p>
</header>
<main>
  <section class="card">
    <div class="row">
      <input id="search" placeholder="Search (e.g., pumpkin, broccoli, bananas)" autocomplete="off" />
    </div>
    <div id="result" style="margin-top:10px"></div>
  </section>

  <section class="card">
    <details>
      <summary><strong>Add or edit an item</strong> <span class="muted">(saved locally)</span></summary>
      <div class="row" style="margin-top:12px">
        <input id="itemName" placeholder="Name (e.g., Pumpkin)" />
        <input id="unit" placeholder="Unit (e.g., $/kg, $ each)" />
        <input id="low" placeholder="Buy at or below (e.g., 1.50)" type="number" step="0.01" />
        <input id="high" placeholder="Avoid above (e.g., 2.50)" type="number" step="0.01" />
      </div>
      <div class="row" style="margin-top:8px">
        <input id="notes" placeholder="Notes (e.g., SA season Oct–Mar; Jap pumpkin ok)" />
        <button id="saveItem">Save / Update</button>
        <button id="deleteItem" title="Delete item">Delete</button>
      </div>
    </details>
  </section>

  <section class="card">
    <div class="row" style="align-items:center">
      <div>
        <strong>Your list</strong> <span class="muted">(tap to load into the editor)</span>
      </div>
      <div class="actions">
        <button id="exportBtn" title="Download JSON backup">Export</button>
        <label class="pill" style="cursor:pointer">Import JSON<input id="importFile" type="file" accept="application/json" class="hidden" /></label>
        <button id="resetBtn" title="Restore starter set">Reset to starter</button>
      </div>
    </div>

    <div class="table" style="margin-top:12px">
      <div class="grid header" style="padding:8px 0;border-bottom:1px solid #273055">
        <div>Item</div><div style="text-align:right">Buy ≤</div><div style="text-align:right">Avoid ≥</div><div style="text-align:right">Unit</div>
      </div>
      <div id="list"></div>
    </div>
  </section>
</main>
<div class="footer"><div id="toast" class="toast hidden"></div></div>

<script>
(function(){
  // --- Starter dataset (tune to your local market & season) ---
  const STARTER = [
    {name:"Bananas", low:2.00, high:3.50, unit:"$/kg", notes:"Cavendish; buy ≤$2.5 in season"},
    {name:"Apples", low:2.50, high:4.00, unit:"$/kg", notes:"Pink Lady/Royal Gala"},
    {name:"Avocado", low:1.00, high:2.50, unit:"$ each", notes:"Hass; tray specials common"},
    {name:"Broccoli", low:2.00, high:4.00, unit:"$/kg", notes:"Florets cost more"},
    {name:"Carrots", low:1.20, high:2.00, unit:"$/kg", notes:"Pre-pack often cheaper"},
    {name:"Cucumbers", low:1.00, high:2.00, unit:"$ each", notes:"Lebanese"},
    {name:"Capsicum (red)", low:3.00, high:6.00, unit:"$/kg", notes:"Green cheaper"},
    {name:"Grapes", low:3.00, high:6.00, unit:"$/kg", notes:"Seedless"},
    {name:"Mango", low:1.50, high:3.50, unit:"$ each", notes:"Summer specials vary"},
    {name:"Onions", low:1.20, high:2.20, unit:"$/kg", notes:"Brown"},
    {name:"Oranges", low:1.50, high:3.00, unit:"$/kg", notes:"Navel/Washington"},
    {name:"Potatoes", low:1.80, high:3.50, unit:"$/kg", notes:"Washed brushed"},
    {name:"Pumpkin", low:1.00, high:2.00, unit:"$/kg", notes:"Kent/Jap; whole cheaper"},
    {name:"Spinach (bag)", low:1.80, high:3.50, unit:"$ per 120–200g", notes:"Compare unit price"},
    {name:"Strawberries", low:1.50, high:3.00, unit:"$ per 250g", notes:"Seasonal"},
    {name:"Tomatoes", low:2.00, high:4.50, unit:"$/kg", notes:"Roma/truss differ"}
  ];

  const KEY = 'produce_price_checker_v1';
  let data = load();

  // DOM helpers
  const $ = s => document.querySelector(s);
  const el = (tag, props={}) => Object.assign(document.createElement(tag), props);
  const fmt = n => (typeof n === 'number' && !Number.isNaN(n)) ? n.toFixed(2) : '';

  function load(){
    try{
      const raw = localStorage.getItem(KEY);
      if(raw){
        const parsed = JSON.parse(raw);
        if(Array.isArray(parsed)) return parsed;
      }
    }catch{}
    localStorage.setItem(KEY, JSON.stringify(STARTER));
    return [...STARTER];
  }
  function save(){ localStorage.setItem(KEY, JSON.stringify(data)); }

  function toast(msg){
    const t = $('#toast');
    t.textContent = msg; t.classList.remove('hidden');
    setTimeout(()=>t.classList.add('hidden'), 1800);
  }

  function normalizeName(s){return (s||'').trim();}
  function findItemByName(name){
    const needle = normalizeName(name).toLowerCase();
    return data.find(x => x.name.toLowerCase() === needle) || null;
  }
  function upsertItem(item){
    const i = data.findIndex(x => x.name.toLowerCase() === item.name.toLowerCase());
    if(i>=0) data[i] = item; else data.push(item);
    data.sort((a,b)=>a.name.localeCompare(b.name));
    save(); renderList();
  }
  function deleteByName(name){
    const needle = normalizeName(name).toLowerCase();
    const before = data.length;
    data = data.filter(x => x.name.toLowerCase() !== needle);
    if(data.length !== before){ save(); renderList(); return true; }
    return false;
  }

  function renderList(){
    const wrap = $('#list');
    wrap.innerHTML = '';
    data.forEach(item => {
      const row = el('div', {className:'grid item', role:'button', tabIndex:0});
      const name = el('div', {textContent:item.name});
      const low = el('div', {style:'text-align:right', textContent: fmt(item.low)});
      const high = el('div', {style:'text-align:right', textContent: fmt(item.high)});
      const unit = el('div', {style:'text-align:right', textContent:item.unit||''});
      row.append(name, low, high, unit);
      row.addEventListener('click', ()=> loadToEditor(item));
      row.addEventListener('keypress', e=>{ if(e.key==='Enter') loadToEditor(item); });
      wrap.append(row);
    });
  }

  function loadToEditor(item){
    $('#itemName').value = item.name;
    $('#unit').value = item.unit || '';
    $('#low').value = (item.low ?? '')
    $('#high').value = (item.high ?? '')
    $('#notes').value = item.notes || '';
  }

  function lookup(term){
    const q = (term||'').toLowerCase().trim();
    if(!q) return [];
    return data.filter(x => x.name.toLowerCase().includes(q)).slice(0,6);
  }

  function colorFor(price, low, high){
    if(typeof price !== 'number' || Number.isNaN(price)) return '';
    if(typeof low === 'number' && price <= low) return 'good';
    if(typeof high === 'number' && price >= high) return 'bad';
    return 'warn';
  }

  function renderResult(term){
    const res = $('#result');
    const matches = lookup(term);
    if(matches.length===0){ res.innerHTML = '<span class="muted">No matches yet. Add it below.</span>'; return; }
    const wrap = el('div');
    matches.forEach(m => {
      const div = el('div', {className:'card', style:'background:#0f1530;border:1px solid #2a355f;margin:8px 0'});
      const title = el('div');
      title.innerHTML = `<strong>${m.name}</strong> <span class="pill tag">${m.unit||''}</span>`;
      const range = el('div', {className:'muted', style:'margin:6px 0'});
      range.innerHTML = `Buy at or below <strong class="good">${fmt(m.low)}</strong> · Avoid above <strong class="bad">${fmt(m.high)}</strong>`;

      // Quick test box for what you're seeing in-store
      const testRow = el('div', {className:'row'});
      const testInput = el('input', {placeholder:`Enter price you see now (${m.unit||''})`, type:'number', step:'0.01'});
      const verdict = el('div', {className:'pill', textContent:'Enter a price to check'});
      testInput.addEventListener('input', ()=>{
        const p = parseFloat(testInput.value);
        const cls = colorFor(p, m.low, m.high);
        verdict.className = 'pill ' + (cls||'');
        if(!testInput.value){ verdict.textContent = 'Enter a price to check'; return; }
        verdict.textContent = cls==='good' ? 'Buy' : (cls==='bad' ? 'Too high' : 'Okay / consider');
      });
      testRow.append(testInput, verdict);

      const note = el('div', {className:'muted', style:'margin-top:6px'});
      note.textContent = m.notes || '';

      const btnRow = el('div', {className:'actions', style:'margin-top:8px'});
      const editBtn = el('button', {textContent:'Edit'});
      editBtn.addEventListener('click', ()=>loadToEditor(m));
      btnRow.append(editBtn);

      div.append(title, range, testRow, note, btnRow);
      wrap.append(div);
    });
    res.innerHTML = '';
    res.append(wrap);
  }

  // --- Events ---
  $('#search').addEventListener('input', e=> renderResult(e.target.value));

  $('#saveItem').addEventListener('click', ()=>{
    const name = normalizeName($('#itemName').value);
    const unit = $('#unit').value.trim();
    const low = $('#low').value===''? null : parseFloat($('#low').value);
    const high = $('#high').value===''? null : parseFloat($('#high').value);
    const notes = $('#notes').value.trim();
    if(!name){ toast('Name is required'); return; }
    if(low!=null && high!=null && low>high){ toast('"Buy ≤" should be less than "Avoid ≥"'); return; }
    upsertItem({name, unit, low, high, notes});
    toast('Saved');
  });

  $('#deleteItem').addEventListener('click', ()=>{
    const name = normalizeName($('#itemName').value);
    if(!name){ toast('Nothing to delete'); return; }
    if(deleteByName(name)){
      toast('Deleted');
      $('#itemName').value='';$('#unit').value='';$('#low').value='';$('#high').value='';$('#notes').value='';
      renderResult($('#search').value);
    } else toast('Not found');
  });

  $('#exportBtn').addEventListener('click', ()=>{
    const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = el('a',{href:url,download:'produce-price-list.json'});
    document.body.append(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  });

  $('#importFile').addEventListener('change', (e)=>{
    const file = e.target.files[0]; if(!file) return;
    const reader = new FileReader();
    reader.onload = ()=>{
      try{
        const arr = JSON.parse(reader.result);
        if(Array.isArray(arr)){
          data = arr.filter(x=>x && x.name).map(x=>({
            name: String(x.name),
            unit: x.unit||'',
            low: typeof x.low==='number'?x.low: (x.low?parseFloat(x.low):null),
            high: typeof x.high==='number'?x.high: (x.high?parseFloat(x.high):null),
            notes: x.notes||''
          }));
          data.sort((a,b)=>a.name.localeCompare(b.name));
          save(); renderList(); renderResult($('#search').value);
          toast('Imported');
        } else throw new Error('Invalid file');
      }catch(err){ toast('Import failed'); }
      e.target.value='';
    };
    reader.readAsText(file);
  });

  $('#resetBtn').addEventListener('click', ()=>{
    if(confirm('Restore the starter list? This will overwrite your current list.')){
      data = [...STARTER]; save(); renderList(); renderResult($('#search').value); toast('Starter list restored');
    }
  });

  // initial render
  renderList();
})();
</script>
</body>
</html>
